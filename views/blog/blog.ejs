<%- include('../includes/head.ejs') %>
<link rel="stylesheet" href="/assets/css/badges.css">

	</head>

	<body class="is-preload">
		<% if(typeof successMessage !== 'undefined' && successMessage)  { %>
			<div class="flash-message success" style="display: block">
				<%= successMessage %>
					<span class="close-button">&times;</span>
			</div>
		<% } %>

				<!-- Wrapper -->
				<div id="wrapper">

					<!-- Header -->
					<!-- Menu -->
					<%- include('../includes/navigation.ejs') %>

						<!-- Main -->
						<div id="main">
							<!-- Post -->
							 <p>Показывать посты упорядоченные по дате, а если есть рекомендуемые, то сначала их</p>

							<% if (allPosts && allPosts.length > 0) { %>
								<% for (let post of allPosts) { %>
									<article class="post page-preview">
										<header>
											<div class="title">
												<h2><a href="/posts/<%= post.id %>">
														<%- fixPrepositions(post.title) %>
													</a></h2>
											</div>
											<div class="meta">
												<time class="published" datetime="<%= post.createdAt %>">
													<%= formatDateOnly(post.createdAt) %>
												</time>
												<a href="#" class="author category-post-logo"><span class="name">
														<%= post.category.name %>
													</span><img src="<%= post.category.image %>" alt="" /></a>
											</div>
										</header>
										<a href="/posts/<%= post.id %>" class="image featured">
											<img src="<%= post.cover %>" alt="" />
										</a>
										<p>
											<%- fixPrepositions(post.preview) %>
										</p>
										<footer>
											<ul class="actions">
												<li><a href="/posts/<%= post.id %>" class="button large">Continue
														Reading</a>
												</li>
											</ul>
											<ul class="stats">
												<li><a href="#">
														<%= post.category.name %>
													</a></li>
												
													<li>
														<a href="#"
															class="like-icon icon solid fa-heart <%= isAuthenticated ? '' : 'not-hover' %> <%= post.likedUsers && post.likedUsers.length > 0 ? 'active' : '' %>"
															data-id="<%= post.id %>">
															<%= post.likes %>
														</a>
													</li>
												
														<li>
															<% if (isAuthenticated) { %>
																<a href="/posts/<%= post.id %>#comments"
																	class="icon solid fa-comment">
																	<%= post.commentsCount || 0 %>
																</a>
															<% } else { %>
															
																		<a class="icon solid fa-comment not-active">
																			<%= post.commentsCount || 0 %>
																		</a>
																		<% } %>

														</li>
											</ul>
										</footer>
									</article>
									<% } %>
										<% } else { %>
											<h1>No Posts Found!</h1>
										<% } %>

										<%- include('../includes/pagination.ejs', {currentPage, hasNextPage, hasPreviousPage, nextPage, previousPage, lastPage, totalPages}) %>

										 <!-- Pagination -->
										<ul class="actions pagination">
											<li><a href="?page=<%= previousPage %>" class="<%= hasPreviousPage ? '' : 'disabled' %> button large previous">Предыдущая</a></li>
											<li><a href="?page=<%= nextPage %>" class="<%= hasNextPage ? '' : 'disabled' %> button large next">Следующая</a></li>
										</ul>
						</div>

						<!-- Sidebar -->
						<section id="sidebar">

							<!-- Intro -->
							<section id="intro">
								<a href="#" class="logo"><img src="images/logo.jpg" alt="" /></a>
								<header>
									<h2>Тема Дня — Каждый День</h2>
									<p>Твой журнал обо всём важном и интересном</p>
								</header>
							</section>

							<!-- Mini Posts -->
							<section>
								<h3>Всё, Что Важно</h3>
								<p>3-5 карточек топовых постов из каждой категории</p>
								<div class="mini-posts">
									<% if (topPosts.length > 0) { %>
									
										<% for (let post of topPosts) { %>
											<!-- Mini Post -->
											<article class="mini-post">

												<header>

													<h3><a href="/posts/<%= post.id %>">
															<%= post.title %>
														</a></h3>
													<div class="post-info">
														<time class="published" datetime="<%= post.createdAt %>">
															<%= formatDateOnly(post.createdAt) %>
														</time>
														<a href="#" class="published category-link">
															<%= post.categoryName %>
														</a>

														<a href="#" class="author"><img src="" alt="" /></a>
													</div>
												</header>

												<a href="single.html" class="image mini"><img class="img-mini"
														src="<%= post.image %>" alt="" /></a>

											</article>
											<% } %>
												<% } else { %>
													<h1>No Posts Found!</h1>
													<% } %>

								</div>
							</section>

							<section>
								<h3>Рекомендуемое вам</h3>
								<p>ПОказывать 3-5 карточек из рекомендуемых постов с наивысших рейтингом</p>
								<div class="mini-posts">
									<% if (recomendedPosts.length > 0) { %>
									
										<% for (let post of recomendedPosts) { %>
											<!-- Mini Post -->
											<article class="mini-post">

												<header>

													<h3><a href="single.html">
															<%= post.title %>
														</a></h3>
													<div class="post-info">
														<time class="published" datetime="<%= post.createdAt %>">
															<%= formatDateOnly(post.createdAt) %>
														</time>
														<a href="#" class="published category-link">
															<%= post.categoryName %>
														</a>

														<a href="#" class="author"><img src="" alt="" /></a>
													</div>
												</header>

												<a href="single.html" class="image mini"><img class="img-mini"
														src="<%= post.image %>" alt="" /></a>

											</article>
											<% } %>
												<% } else { %>
													<h1>No Posts Found!</h1>
													<% } %>

								</div>
							</section>

							<!-- Posts List -->
							<section>
								<h3>Мир Вокруг Нас</h3>
								<p>Самый новый пост в каждой категории</p>
								<ul class="posts">
									<% if (latestPostsByCategory && latestPostsByCategory.length> 0) { %>
										<% for (let post of latestPostsByCategory) { %>
											<li>
												<article>
													<header>
														<h3><a href="single.html">
																<%- fixPrepositions(post.title) %>
															</a></h3>
													</header>
													<a href="single.html" class="image"><img
															src="<%= post.categoryImage %>"
															alt="<%= post.categoryName %>" /></a>

												</article>
											</li>
											<% } %>
												<% } else { %>
													<h1>No Posts Found!</h1>
													<% } %>
								</ul>
							</section>

							<!-- About -->
							<section class="blurb">
								<h2>О блоге</h2>
								<p> <%- fixPrepositions(`The Everything Journal — твой путеводитель по миру знаний, идей
										и вдохновения.`) %></p>
								<p> <%- fixPrepositions(` Здесь мы говорим обо всём: от кулинарии и путешествий до
										технологий и программирования. `) %></p>

								<p> <%- fixPrepositions(`Блог создан для тех, кто любит учиться, развиваться и
										интересуется всем, что происходит вокруг. `) %></p>
								<ul class="actions">
									<li><a href="/about" class="button">Далее</a></li>
								</ul>
							</section>

	<%- include('../includes/footer.ejs') %>
	<%- include('../includes/main-scripts.ejs') %>

	<script src="/assets/js/postHandler.js"></script>
    <%- include('../includes/scripts.ejs') %>
  